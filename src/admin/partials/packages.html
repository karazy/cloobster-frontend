<!-- Field: name, maxSpotCount, quotaExceeded, (Translation mittels Key abarbeiten basierend Paketname), basic, cost, status (approved, pending, canceled), startDate, endDate, Vererbung in Objectify prÃ¼fen Template und davon erbt konkrete Subscription -->
<div class="partial-wrapper">
	<ul class="nav nav-tabs">
  		<li ng-class="{active : activeTab == 'locations'}">
    		<a ng-click="activeTab = 'locations'">Companies</a>
  		</li>
  		<li ng-class="{active : activeTab == 'pending'}">
  			<a ng-click="loadPendingSubscriptions()">Pending</a>
  		</li>
  		<li ng-class="{active : activeTab == 'packages'}">
  			<a ng-click="activeTab = 'packages'">Subscriptions</a>
  		</li>
	</ul>

	<!-- Companies tab -->
	<div ng-show="activeTab == 'locations'">		
		<div class="row-fluid">
		
			<form class="form-inline span12" style="margin: 7px 0;">
				<div class="controls">
				<div class="input-prepend">
					<span class="add-on"><i class="icon-search icon-black"></i>
					</span>
					<input l="common.search" type="text" l-attribute="placeholder" placeholder="Search" class="span10"  ng-model="companyQuery.name">
				</div>
				<i class="icon-remove icon-black" ng-click="companyQuery = {};">
				</i> 
				</div>
			</form>	
		</div>
	
		<div class="row-fluid" >
			<div class="span12">
				<div ng-repeat="c in companies | filter:companyQuery" class="data-container-with-title">
					<h4 class="data-container-title">{{c.name}}</h4>
					<div class="data-container-block data-container-seperator">
						<h5>Company Profile</h5>
						Address:{{c.address}} | City: {{c.city}} | Phone: {{c.phone}}
					</div>
					<div class="">					
						
						<div>							
							<div class="data-container-block">	
								<h5>Locations</h5>
								<div class="row-fluid">	
												
									<div class="span1" style="font-weight:bold;">Expand</div>
									<div class="span2" style="font-weight:bold;">Name</div>
									<div class="span3" style="font-weight:bold;">Address</div>
									<div class="span2" style="font-weight:bold;">eMail</div>
									<div class="span2" style="font-weight:bold;">Website</div>						
								</div>
							</div>
							<div ng-repeat="l in locationsMap[c.id]" class="data-container-block data-container-seperator">
								<div class="row-fluid">
									<div class="span1">
										<button class="btn btn-small" ng-click="showLocationDetail(l)">
											<i class="icon-eye-open" id="toggle_open_{{l.id}}"></i>
											<i class="icon-eye-close" id="toggle_close_{{l.id}}" style="display:none;"></i>
										</button>
									</div>
									<div class="span2">{{l.name}}</div>
									<div class="span3">{{l.address}}<span ng-show="l.postcode">, </span>{{l.postcode}}<span ng-show="l.city">, </span>{{l.city}}</div>
									<div class="span2">{{l.email}}</div>
									<div class="span2">{{l.url}}</div>
								</div>
								<div class="row-fluid" id="details_{{l.id}}" style="display: none; margin-top:10px;">
									<form class="form-inline">
										<select ng-model="l.tempSubscription" ng-options="s.name for s in packages">
											<option value="">-- chose subscription --</option>
										</select>
										<button class="btn btn-primary" ng-click="setActivePackageForLocation(l)">Set active Package</button>
									</form>

									<div style="margin-top: 5px;">
										<h4 ng-show="l.subscriptions.length > 0">Subscriptions</h4>
										<div class="row-fluid">
											<div class="span2">Name</div>
											<div class="span2">Status</div>
											<div class="span2">Start Date</div>
											<div class="span2">End Date</div>
											<div class="span2">Action</div>											 
										</div>
										<div ng-repeat="s in l.subscriptions | orderBy:'-id'">
											<div class="row-fluid">
												<div class="span2">{{s.name}}</div>
												<div class="span2">{{s.status}}</div>
												<div class="span2">{{s.startDate | date:short}}</div>
												<div class="span2">{{s.endDate | date:short}}</div>
												<div class="span2">
													<button class="btn btn-small btn-primary" ng-show="s.status == 'PENDING'">Approve</button>
													<button class="btn btn-small btn-warning" ng-show="s.status == 'APPROVED'">Disable</button>
												</div>											 
											</div>
										</div>
									</div>
									
								</div>
							</div>
						</div>
				</div>				
				</div>
			</div>
		</div>
	</div>

	<!-- Pending subscriptions tab -->
	<div ng-show="activeTab == 'pending'">
		<div class="row-fluid">
			<div class="span12 data-container-with-title">				
				<h4 class="data-container-title">Pending subscriptions</h4>
				<div class="data-container-block">
					<div class="row-fluid">
						<div class="span2">Location</div>
						<div class="span2">Current Subscription</div>
						<div class="span2">Upgrade To</div>
						<div class="span2">Status</div>
						<div class="span2">Action</div>
					</div>
					<div ng-repeat="sp in pendingSubscriptions" class="data-container-block">
						<div class="row-fluid">
							<div class="span2">{{pendingSubscriptions[sp.businessId].name}}</div>
							<div class="span2"></div>
							<div class="span2">{{sp.name}}</div>
							<div class="span2">{{sp.status}}</div>
							<div class="span2">								
								<button class="btn btn-small btn-primary" ng-click="approvePendingSubscription(sp)" ng-show="sp.status == 'PENDING'">Approve</button>
								<button class="btn btn-small btn-danger" ng-click="cancelPendingSubscription(sp)" ng-show="sp.status == 'PENDING'">Cancel</button>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>

	<!-- Subscription management tab -->
	<div class="row-fluid" ng-show="activeTab == 'packages'">
		<div class="span2">
			<div class="data-container-with-title">
				<h4 class="data-container-title">Packages</h4>
				<div class="data-container-block data-container-seperator">
					<div class="row-fluid">
						<button class="btn btn-primary span6" ng-click="newPackage()"><i class="icon-plus-sign icon-white"></i> New</button>
						<button class="btn btn-primary span6" ng-click="showPackages()"><i class="icon-list-alt icon-white"></i> All</button>						 
					</div>
				</div>
				<ul class="nav nav-pills nav-stacked data-container-block data-container-large data-container-scrollable">
		        	<li ng-repeat="p in packages | orderBy:['name'] " ng-class="{active: currentPackage.id == p.id}">
		        		<a ng-click="showPackage(p)">{{p.name}} <span class="badge badge-success" ng-show="p.basic">Basic</span></a>
			        </li>
			    </ul>
			</div>
		</div>
		<!-- single package view -->
		<div ng-hide="showAllPackages == true" class="span4">
			<!-- edit existing package -->
			<div ng-show="currentPackage && currentPackage.id">
				<div class="data-container-with-title">
					<h4 class="data-container-title">Edit Package</h4>						
						<div class="data-container-block data-container-small">
							<div simple-property-editor editor-title="Name" editor-property="currentPackage.name" editor-on-save="savePackage()" editor-placeholder="infopage.placeholder.shortText" editor-required>
								<h5 class="edit">
									{{currentPackage.name}} <i class="icon-edit icon-black"></i>
								</h5>
							</div>
							<div simple-property-editor editor-title="Maximum Spots" editor-property="currentPackage.maxSpotCount" editor-on-save="savePackage()" editor-placeholder="infopage.placeholder.shortText" editor-required editor-type="number">
								<p class="edit">
									{{currentPackage.maxSpotCount}} <i class="icon-edit icon-black"></i>
								</p>
							</div>
							<div simple-property-editor editor-title="Maximum Spots" editor-property="currentPackage.fee" editor-on-save="savePackage()" editor-placeholder="infopage.placeholder.shortText" editor-required editor-type="number">
								<p class="edit">
									{{currentPackage.fee}} <i class="icon-edit icon-black"></i>
								</p>
							</div>
							<div class="row-fluid" ng-hide="currentPackage.basic">
								<button class="btn btn-success span6" ng-click="setCurrentPackageAsBasic()"><i class="icon-ok icon-white"></i> Set as Basic</button>								
								<button class="btn span6" ng-click="deletePackage()"><i class="icon-trash"></i></button>
							</div>
							<div ng-show="currentPackage.basic">
								Basic packages can't be deleted.
							</div>							
					</div>
				</div>
			</div>
			<!-- add new package -->
			<div ng-show="currentPackage && !currentPackage.id">
				<div class="data-container-with-title">
					<h4 class="data-container-title">New Package</h4>
					<div class="data-container-block">
						<form name="newPackageForm" ng-submit="savePackage()" class="form-horizontal">
							<div class="control-group" ng-class="getFieldInputClass(newPackageForm.packageName.$dirty, newPackageForm.packageName.$invalid)">
								<label for="packageName" class="control-label">Name*</label>
								<div class="controls">
									<input name="packageName" id="packageName" type='text' ng-model="currentPackage.name" required placeholder="e.g. M">	
									 <div class="help-inline" ng-show="newPackageForm.packageName.$dirty && newPackageForm.packageName.$invalid">
						          		<span ng-show="newPackageForm.packageName.$error.required">Required field.</span>
						          		<span ng-show="newPackageForm.packageName.$error.minlength">At least one character required.</span>
						        	</div>
					        	</div>
				        	</div>
				        	<div class="control-group" ng-class="getFieldInputClass(newPackageForm.controls.$dirty, newPackageForm.controls.$invalid)">
								<label for="spotsCount" class="control-label">Maximum number of spots*</label>
								<div class="controls">
									<input name="spotsCount" id="spotsCount" type='number' ng-model="currentPackage.maxSpotCount" ng-disabled="currentPackage.basic" required min="0" max="100000" placeholder="e.g. 150 (0 means unlimited)">	
									 <div class="help-inline" ng-show="newPackageForm.spotsCount.$dirty && newPackageForm.spotsCount.$invalid">
						          		<span ng-show="newPackageForm.spotsCount.$error.required">Required field.</span>
						          		<span ng-show="newPackageForm.spotsCount.$error.min">Values must be equal or greater then zero.</span>
						        	</div>
					        	</div>
				        	</div>				        	
				        	<div class="control-group" ng-class="getFieldInputClass(newPackageForm.fee.$dirty, newPackageForm.fee.$invalid)">
								<label for="fee" class="control-label">Fee*</label>
								<div class="controls">
									<input name="fee" id="fee" type='number' ng-model="currentPackage.fee" min="0" max="10000" ng-disabled="currentPackage.basic" required>	
									 <div class="help-inline" ng-show="newPackageForm.fee.$dirty && newPackageForm.fee.$invalid">
						          		<span ng-show="newPackageForm.fee.$error.required">Required field.</span>
						          		<span ng-show="newPackageForm.fee.$error.min">Values must be equal or greater then zero.</span>
						          		<span ng-show="newPackageForm.fee.$error.max">Maximum is 10000.</span>
						        	</div>
					        	</div>
				        	</div>
				        	<div class="control-group" ng-class="getFieldInputClass(newPackageForm.basic.$dirty, newPackageForm.basic.$invalid)">
								<label for="basic" class="control-label">Basic</label>
								<div class="controls">
									<input name="basic" id="basic" type='checkbox' ng-model="currentPackage.basic" ng-change="currentPackage.maxSpotCount = 1; currentPackage.fee=0;">	
									 <div class="help-inline" ng-show="newPackageForm.basic.$dirty && newPackageForm.basic.$invalid">
						          		<span ng-show="newPackageForm.basic.$error.required">Required field.</span>
						          		<span ng-show="newPackageForm.basic.$error.min">Values must be equal or greater then zero.</span>
						        	</div>
					        	</div>
				        	</div>
				        	<div class="row-fluid">
				        		<div class="span8"></div>
				        		<button type="submit" class="btn btn-primary span4" ng-disabled="newPackageForm.$invalid">Save</button>
				        	</div>				        	
						</form>
					</div>
				</div>
			</div>
			<!-- empty package placeholder -->
			<div ng-hide="currentPackage">
				<div class="data-container-with-title data-container-inactive">
					<h4 class="data-container-title">Package</h4>
					<div class="data-container-block data-container-small">
						<p>Add new packages or edit existing ones.</p>
					</div>
				</div>
			</div>
		</div>
		<!-- alll packages view -->
		<div class="span8" ng-show="showAllPackages == true">
			<div class="data-container-with-title">
				<h4 class="data-container-title">All Packages</h4>
				<div class="data-container-block">
					<p ng-hide="packages.length > 0">No packages configured.</p>
					<table class="table table-striped table-hover table-bordered">
						<tr>
							<th>Name</th>
							<th>Maximum Spots</th>
							<th>Fee</th>
							<th>Basic</th>
						</tr>						
						<tr ng-repeat="p in packages">
							<td>{{p.name}}</td>
							<td>{{p.maxSpotCount | mSCFF:p.basic}}</td>
							<td>{{p.fee}}</td>
							<td>
								<i class="icon-ok" ng-show="p.basic"></i>
								<button class="btn btn-small" ng-click="setBasicPackage(p)" ng-hide="p.basic">Set basic</i>
							</td>
						</tr>
					</table>
				</div>
			</div>
		</div>
	</div>
</div>

