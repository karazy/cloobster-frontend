<div ng-controller="Cloobster.Menu" class="menus-wrapper">
<div class="row-fluid">
	<div class="span12">
		<ul class="breadcrumb">
			<li>
				<a href="#/businesses" l="breadcrumb.businesses">My Restaurants</a> <span class="divider">/</span>
			</li>
			<li>
				<a href="#/businesses/{{activeBusiness.id}}">{{activeBusiness.name}}</a> <span class="divider">/</span>
			</li>
			<li class="active">Menus</li>
		</ul>
	</div>
</div>
<div class="row-fluid" ng-show="error">
	<div class="alert alert-error alert-block span9" >
		<button class="close" ng-click="hideError()">×</button>
		<h4 class="alert-heading" l="common.warning.title">Error!</h4>
		{{errorMessage}}
	</div>
</div>
	<h1 l="menus.title">Menus</h1>
		<div class="row-fluid">
			<div class="menus-list span2">
			<ul class="nav nav-pills nav-stacked" id="menuList">
				<li>
					<a ng-click="createMenu()"><i class="icon-plus icon-black"></i> <span l="menus.list.new">New menu...</span></a>
				</li>
				<li ng-class="{active: organizeMenusContext}">
					<a ng-click="organizeMenus()"><i class="icon-th-large icon-black"></i> <span l="menus.list.organize">Organize menus</span></a>
				</li>
		        <li ng-repeat="menu in menus | orderBy:['order', 'title'] " ng-class="{active: currentMenu.id == menu.id}" class="sortable">	        	
		        	<a ng-click="loadMenu(menu)"><i class="icon-move icon-black" tooltip="general.sortable" tooltip-position="right"></i> {{menu.title}}</a>
		        </li>
		        <li ng-class="{active: orphanedProducts.length > 0 && !currentMenu}">
		        	<a ng-click="loadOrphanedProducts()"><i class="icon-exclamation-sign icon-black" tooltip="menus.list.orphaned.tooltip" tooltip-position="right"></i> <span l="menus.list.orphaned">Unassigned products</span></a>
		        </li>
		    </ul>
		</div>

		<!-- Orphaned products list -->
		<div class="span3 product-wrapper product-detail" ng-show="orphanedProducts.length > 0">
	    	<h3 l="menus.products.orphaned.title">Orphaned Products</h3>
	    	<p l="menus.products.orphaned.description">List of products not assigned to any menu.</p>
	    	<span l="common.search">Search</span>: <input ng-model="productOrphanedQuery.name">
    		<ul class="nav nav-pills nav-stacked">
	       	 	<li ng-repeat="product in orphanedProducts | filter:productOrphanedQuery | orderBy:['order', 'name']" class="product-item" ng-class="{active: currentProduct.id == product.id}">
		        	<a ng-click="loadProduct(product)">{{product.name}}</a>
		        </li>
    		</ul>
	    </div>

	    <!-- Organize menu lists -->
	    <div class="span6 common-wrapper" ng-show="organizeMenusContext">
	    	<h3 l="menus.products.organize.title">Organize Menus</h3>
	    	<p l="menus.organizable-product-list.organize.description">Choose menus from both lists.<br/>Drag & Drop products to assign them to another menu.</p>
	    	<div class="row-fluid">
	    		<div class="span6">
	    			<div class="btn-group">
			    		<button class="btn dropdown-toggle"  data-toggle="dropdown">
			    			<span l="menus.organize.choose">Choose menu</span>
			    			<span class="caret"></span>
			    		</button>			    		
			        	<ul class="dropdown-menu">
			        		<li>
			        			<a ng-repeat="menu in menus" ng-click="fillOrganizeList(menu, 1)">
			        			{{menu.title}}
			        			</a>
			        		</li>
	    				</ul>
		    		</div>
		    		<h4>{{organizeMenusContext.menu1.title}}</h4>
	    			<ul class="nav nav-pills nav-stacked organizable-product-list" id="organizeList1">
				        <li ng-repeat="product in organizeMenusContext.productOrganizeList1 | orderBy:['order', 'name'] ">	        	
				        	<a><i class="icon-move icon-black" tooltip="menus.organize.list.tooltip"></i> {{product.name}}</a>
				        </li>
				    </ul>
	    		</div>
	    		<div class="span6">
	    			<div class="btn-group">
			    		<button class="btn dropdown-toggle"  data-toggle="dropdown">
			    			<span l="menus.organize.choose">Choose menu</span>
			    			<span class="caret"></span>
			    		</button>			    	
			        	<ul class="dropdown-menu">
			        		<li>
			        			<a ng-repeat="menu in menus" ng-click="fillOrganizeList(menu, 2)">
			        			{{menu.title}}
			        			</a>
			        		</li>
	    				</ul>
		    		</div>
		    		<h4>{{organizeMenusContext.menu2.title}}</h4>
	    			<ul class="nav nav-pills nav-stacked organizable-product-list" id="organizeList2">
				        <li ng-repeat="product in organizeMenusContext.productOrganizeList2 | orderBy:['order', 'name'] ">	        	
				        	<a><i class="icon-move icon-black" tooltip="menus.organize.list.tooltip"></i> {{product.name}}</a>
				        </li>
				    </ul>
	    		</div>
	    	</div>
	    </div>

	    <!-- Menu detail -->
	    <div class="span3 menu-wrapper" ng-show="currentMenu">
	    	<div class="menu-detail">
		    	<div simple-property-editor editor-title="menu.editor.title" editor-property="currentMenu.title" editor-on-save="saveMenu()" editor-required>
					<h3 class="edit" tooltip="menus.editor.title.tooltip">{{currentMenu.title}} <i class="icon-edit icon-black"></i></h3>
				</div>
				<div simple-property-editor editor-title="menu.editor.description" editor-property="currentMenu.description" editor-type="textarea" editor-on-save="saveMenu()" editor-required>
		    		<p class="edit" tooltip="menus.editor.description.tooltip">{{currentMenu.description}} <i class="icon-edit icon-black"></i></p>
		    	</div>
		    	<div class="activation-checkbox">
		    		<input type="checkbox" id="menuActiveCb" ng-model="currentMenu.active" ng-change="saveMenu()"></input>
		    		<label l="menus.menu.field.active" for="menuActiveCb">Active: Show menu for guest</label>
		    	</div>
		    	<div>
		    		<button class="btn btn-small" data-toggle="modal" data-target="#deleteMenuModal"><i class="icon-trash"></i> <span l="menus.menu.delete">Delete menu</span></button>
		    		<!-- Modal delete dialog. -->
		    		<div class="modal hide" id="deleteMenuModal">
					 	<div class="modal-header">
					    	<button type="button" class="close" data-dismiss="modal">×</button>
					    	<h3 l="menus.menu.dialog.delete.title">Delete Menu</h3>
						</div>
						<div class="modal-body alert-error">
					    	<p><span l="menus.menu.dialog.delete.text">{{currentMenu.title}} will be deleted!<br/>This can't be undone.</span></p>
					    </div>  
					  	<div class="modal-footer">
					  		<button type="button" class="btn" data-dismiss="modal" l="common.cancel">Cancel</button>
					    	<button type="button" class="btn btn-danger" data-dismiss="modal" ng-click="deleteMenu(currentMenu)" l="common.delete">Delete</button>
						</div>
					</div>
		    	</div>
		    </div>
		     <!-- Menu products -->
	    	<div class="menu-products-list" ng-show="currentMenu.id">
	    		<h3 l="menus.products.title">Products</h3>
	    		<ul class="nav nav-pills nav-stacked" id="productList">
	    			<li>
						<a ng-click="createProduct()"><i class="icon-plus icon-black"></i> <span l="menus.products.list.new">New product...</span></a>
						<a ng-click="showAllProducts()"><i class="icon-plus icon-black"></i> <span l="menus.products.list.existing">Existing product...</span></a>
					</li>
		       	 	<li ng-repeat="product in products | orderBy:['order', 'name']" class="menu-products-item sortable" ng-class="{active: currentProduct.id == product.id}">
			        	<a ng-click="loadProduct(product)"><i class="icon-move icon-black" tooltip="general.sortable"></i> {{product.name}}</a>
			        </li>
	    		</ul>
	    	</div>
	    </div>

	     <!-- All products list -->
	    <div class="span3 product-wrapper product-detail" ng-show="allProducts.length > 0">
	    	<h3 l="menus.products.link.title">All Products</h3>
	    	<p l="menus.products.link.description">Select an existing product to copy it and assign to active menu.</p>
	    	<span l="menus.products.link.search">Search:</span><input ng-model="productCopyQuery.name">
    		<ul class="nav nav-pills nav-stacked">
	       	 	<li ng-repeat="product in allProducts | filter:productCopyQuery" class="product-item dropdown">
		        	<a class="dropdown-toggle" data-toggle="dropdown">{{product.name}}<b class="caret"></b></a>
		        	<ul class="dropdown-menu">
		        		<a ng-click="copyProduct(product)" l="menus.products.link.action.copy">Copy Product</a>
		        		<a ng-click="copyProduct(product, 'link')" l="menus.products.link.action.copylink">Copy Product & Link Choices</a>
		        		<a ng-click="copyProduct(product, 'copy')" l="menus.products.link.action.deepcopy">Copy Product & Copy Choices</a>
    				</ul>
		        </li>
    		</ul>
	    </div>

	     <!-- Product detail -->
	    <div class="span3 product-wrapper" ng-show="currentProduct">
	    	<div class="product-detail">
	    		<div simple-property-editor editor-title="product.editor.name" editor-property="currentProduct.name" editor-on-save="saveProduct()" editor-required>
		    		<h3 class="edit" tooltip="product.editor.name.tooltip">{{currentProduct.name}} <i class="icon-edit icon-black"></i></h3>
		    	</div>
		    	<div simple-property-editor editor-title="product.editor.shortDesc" editor-property="currentProduct.shortDesc" editor-on-save="saveProduct()" editor-required editor-type="textarea">
		    		<p class="edit" tooltip="product.editor.shortDesc.tooltip">{{currentProduct.shortDesc}} <i class="icon-edit icon-black"></i></p>
		    	</div>
		    	<div simple-property-editor editor-title="product.editor.longDesc" editor-property="currentProduct.longDesc" editor-on-save="saveProduct()" editor-required editor-type="textarea">
		    		<p class="edit" tooltip="product.editor.longDesc.tooltip">{{currentProduct.longDesc}} <i class="icon-edit icon-black"></i></p>
		    	</div>
		    	<div simple-property-editor editor-title="product.editor.price" editor-property="currentProduct.price" editor-on-save="saveProduct()" editor-required editor-pattern="/^[0-9]+([.][0-9]+)?$/" editor-pattern-text="product.editor.price.validation" >
		    		<p class="edit"  tooltip="product.editor.price.tooltip">{{currentProduct.price | kcurrency:activeBusiness.currency}} <i class="icon-edit icon-black"></i></p>
		    	</div>
		    	<div class="activation-checkbox">		    		
		    		<input type="checkbox" id="productActiveCb" ng-model="currentProduct.active" ng-change="saveProduct()"></input>
		    		<label l="menus.product.field.active" for="productActiveCb">Active: Show product for guest</label>
		    	</div>
		    	<div>
		    		<button class="btn btn-small" data-toggle="modal" data-target="#deleteProductModal" ng-show="currentMenu"><i class="icon-trash"></i> <span l="menus.product.delete">Delete product</span></button>
		    		<!-- Modal delete dialog. -->
		    		<div class="modal hide" id="deleteProductModal">
					 	<div class="modal-header">
					    	<button type="button" class="close" data-dismiss="modal">×</button>
					    	<h3 l="menus.product.dialog.delete.title">Delete Product</h3>
						</div>
						<div class="modal-body alert-error">
					    	<p><span l="menus.product.dialog.delete.text">{{currentProduct.name}} will be deleted!<br/>This can't be undone.</span></p>
					    </div>  
					  	<div class="modal-footer">
					  		<button type="button" class="btn" data-dismiss="modal" l="common.cancel">Cancel</button>
					    	<button type="button" class="btn btn-danger" data-dismiss="modal" ng-click="deleteProduct(currentProduct)" l="common.delete">Delete</button>
						</div>
					</div>
		    	</div>
		    </div>
		    <div class="product-choices-list" ng-show="currentProduct.id">
	    		<h3 l="menus.choices.title">Choices</h3>
	    		<ul class="nav nav-pills nav-stacked" id="choicesList">	    			
	    			<li>
						<a ng-click="createChoice()"><i class="icon-plus icon-black"></i> <span l="menus.choices.list.new">New choice...</span></a><a ng-click="showAllChoices()"><i class="icon-plus icon-black"></i> <span l="menus.choices.list.existing">Existing choice...</span></a>
					</li>
		       	 	<li ng-repeat="choice in choices" class="product-choice-item sortable" ng-class="{active: currentChoice.id == choice.id}">
			        		<a ng-click="loadChoice(choice)" ng-class="{active: currentChoice.id == choice.id}"><i class="icon-move icon-black" tooltip="general.sortable"></i> {{choice.text}} <i class="icon-bookmark icon-black" tooltip="menus.choices.list.linked" ng-show="choice.parent"></i></a>
			        </li>
	    		</ul>
	    	</div>
	    </div>

	    <div class="span3 choice-wrapper choice-detail" ng-show="allChoices.length > 0">
	    	<h3 l="menus.choices.link.title">All Choices</h3>
	    	<p l="menus.choices.link.description">Select an existing choice to add it to the current product.</p>
	    	<span l="menus.choices.link.search">Search:</span><input ng-model="choiceLinkQuery.text">
    		<ul class="nav nav-pills nav-stacked">
	       	 	<li ng-repeat="choice in allChoices | filter:filterOnlyChoiceParents | filter:filterOnlyNotLinkedChoices | filter:choiceLinkQuery" class="product-choice-item dropdown">
		        	<a class="dropdown-toggle"  data-toggle="dropdown">{{choice.text}}<b class="caret"></b></a>
		        	<ul class="dropdown-menu">
		        		<a ng-click="copyChoice(choice)" l="menus.choices.link.action.copy">Copy</a>
		        		<a ng-click="linkChoice(choice)" l="menus.choices.link.action.link">Link</a>
    				</ul>
		        </li>
    		</ul>
	    </div>

	    <div class="span3 choice-wrapper" ng-show="currentChoice">
	    	<div class="choice-detail">
	    		<div simple-property-editor editor-title="choice.editor.text" editor-property="currentChoice.text" editor-on-save="saveChoice()" editor-required>
		    		<h3 class="edit" tooltip="choice.editor.text.tooltip">{{currentChoice.text}}<i class="icon-edit icon-black"></i></h3>
		    	</div>
		    	<div simple-property-editor editor-title="choice.editor.maxOccurence" editor-property="currentChoice.maxOccurence" editor-on-save="saveChoice()" editor-required>
		    		<p class="edit" tooltip="choice.editor.maxOccurence.tooltip"><span l="menus.choices.field.maxOccurence">Max. selected: {{currentChoice.maxOccurence}}</span> <i class="icon-edit icon-black"></i></p>
		    	</div>
		    	<div simple-property-editor editor-title="choice.editor.minOccurence" editor-property="currentChoice.minOccurence" editor-on-save="saveChoice()" editor-required>
		    		<p class="edit" tooltip="choice.editor.minOccurence.tooltip"><span l="menus.choices.field.minOccurence">Min. selected: {{currentChoice.minOccurence}}</span> <i class="icon-edit icon-black"></i></p>
		    	</div>
		    	<div simple-property-editor editor-title="choice.editor.included" editor-property="currentChoice.included" editor-type="number" editor-on-save="saveChoice()" editor-required>
		    		<p class="edit" tooltip="choice.editor.included.tooltip"><span l="menus.choices.field.included">Options included: {{currentChoice.included}}</span> <i class="icon-edit icon-black"></i></p>
		    	</div>
		    	<div>
		    		<label for="choiceOverridePriceSelect" l="menus.choices.field.overridePrice.label">Price calculation:</label>
		    		<select ng-model="currentChoice.overridePrice" id="choiceOverridePriceSelect" ng-change="saveChoice()">
		    			<option value="NONE" l="menus.choices.field.overridePrice.none">nothing</option>
		    			<option value="OVERRIDE_SINGLE_PRICE" l="menus.choices.field.overridePrice.overridesingleprice">Price per product</option>
		    			<option value="OVERRIDE_FIXED_SUM" l="menus.choices.field.overridePrice.overridefixedsum">Total price</option>
		    		</select>
		    	</div>
		    	<div ng-show="currentChoice.overridePrice == 'OVERRIDE_SINGLE_PRICE' || currentChoice.overridePrice == 'OVERRIDE_FIXED_SUM'">
			    	<div simple-property-editor editor-title="choice.editor.price" editor-property="currentChoice.price" editor-on-save="saveChoice()" editor-required>
			    		<p class="edit"><span l="menus.choices.field.price">Price: {{currentChoice.price | kcurrency:activeBusiness.currency}}</span> <i class="icon-edit icon-black"></i></p>
			    	</div>
		    	</div>
		    	<div ng-hide="isParent(currentChoice.id)">
			    	<span class="nullable">
			    		<label for="choiceParentSelect" l="menus.choices.field.parentselect.label">Select Parent:</label>
			    		<select ng-model="currentChoice.parent" ng-options="c.id as c.text for c in choices | filter:excludeChoice" ng-change="saveChoice()" id="choiceParentSelect">
	          				<option value="" l="menus.choices.field.parentselect.nullparent">-- chose parent --</option>
	        			</select>
	        		</span>
		    	</div>
		    	<div>
			    	<div ng-show="isParent(currentChoice.id)" class="btn-group" style="margin: 0 0 0.5em 0;">
			    		<button class="btn dropdown-toggle"  data-toggle="dropdown">
			    			<span l="menus.choices.field.linkedchoices">Linked Choices</span>
			    			<span class="caret"></span>
			    		</button>
			        	<ul class="dropdown-menu">
			        		<li>
			        			<a ng-repeat="choice in choices | filter:{parent : currentChoice.id}" ng-click="loadChoice(choice)">{{choice.text}}
			        			</a>
			        		</li>
	    				</ul>
			    	</div>
		    	</div>
		    	<div>
			    	<div ng-show="linkedProductsForChoice.length > 1" class="btn-group" style="margin: 0 0 0.5em 0;">
			    		<button class="btn dropdown-toggle"  data-toggle="dropdown" tooltip="menus.choices.field.linkedproducts.help">
			    			<span l="menus.choices.field.linkedproducts">Linked Products</span>
			    			<span class="caret"></span>
			    		</button>
			        	<ul class="dropdown-menu">
			        		<li>
			        			<a ng-repeat="product in linkedProductsForChoice" ng-click="loadProduct(product)">
			        			{{product.name}}
			        			</a>
			        		</li>
	    				</ul>
			    	</div>
		    	</div>
		    	<div>
		    		<button class="btn" ng-click="removeChoice(currentChoice)">
		    			<i class="icon-trash"></i> <span l ="menus.choices.action.remove">Remove choice from product</span>
		    		</button>
		    	</div>
		    </div>
		    <div class="choice-options-list" ng-show="currentChoice">
	    		<h3 l="menus.options.title">Options</h3>
	    		<!-- <button class="btn-small" ng-click="addOption()"><i class="icon-plus"></i> <span l="menus.options.list.new">Add Option</span></button> -->
	    		<ul class="options-list">
	    			<li>
						<a ng-click="addOption()"><i class="icon-plus icon-black"></i> <span l="menus.options.list.new">New option...</span></a>
					</li>
		       	 	<li ng-repeat="option in currentChoice.options" class="choice-option-item">
		       	 		<div class="row-fluid">
		       	 			<div class="span10">
			       	 			<div simple-property-editor editor-title="option.editor.title" editor-property="option.name" editor-on-save="saveChoice()" editor-required>
			       	 				<p class="edit" tooltip="option.editor.name.tooltip">{{option.name}} <i class="icon-edit icon-black"></i></p>
			       	 			</div> 
								<div class="edit" simple-property-editor editor-title="option.editor.price" editor-property="option.price" editor-on-save="	saveChoice()" editor-required>
			       	 				<p class="edit" tooltip="option.editor.price.tooltip">{{option.price | kcurrency:activeBusiness.currency}} <i class="icon-edit icon-black"></i></p>
			       	 			</div> 
		       	 			</div>
		       	 			<div class="span2">
		       	 			 	<button class="btn btn-small" ng-click="removeOption($index)"><i class="icon-trash"></i></button>
		       	 			</div>
		       	 		</div>		       	 				       	 		
			        </li>
	    		</ul>
	    	</div>
	    </div>

	</div>
</div>