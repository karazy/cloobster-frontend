<div class="row-fluid">
	<div class="span12">
		<h1 l="accounts.title">Account Management</h1>
		<ul class="nav nav-tabs">
			<li ng-class="{active: tab =='admin'}">
				<a ng-click="showAdminTab()" l="accounts.tab.admin">Admin</a>
			</li>
			<li ng-class="{active: tab=='cockpit'}">
				<a ng-click="showCockpitTab()" l="accounts.tab.cockpit">Cockpit</a>
			</li>
		</ul>
	</div>
</div>
<div class="row-fluid">
	<!-- Tab for admin accounts. -->
	<div ng-show="tab == 'admin'">
		<div class="span2">
			<ul class="nav nav-pills nav-stacked">
				<li>
					<a ng-click="createAdminAccount()"><i class="icon-plus icon-black"></i> <span l="accounts.admin.list.new">New account...</span></a>
				</li>
		        <li ng-repeat="account in admins | orderBy:['name'] " ng-class="{active: currentAdmin.id == account.id}">	        	
		        	<a ng-click="loadAdminAccount(account)">{{account.name}}</a>
		        </li>
		    </ul>
		</div>
		<!-- Account details -->
		<div class="common-wrapper span4 form-vertical" ng-show="currentAdmin">
			<label for="adminEmail" l="accounts.admin.mail">Email: </label>
			<input type="email" ng-model="currentAdmin.email" id="adminEmail"/>
			<button class="btn btn-primary" ng-click="checkAdminAccountEmail()" l="accounts.admin.mail.check" ng-disabled="!currentAdmin.email" ng-hide="currentAdmin.id">Check email</button>
			
			<div ng-show="emailValid || currentAdmin.id">
				<label for="adminName" l="accounts.admin.name">Name: </label>
				<input type="text" id="adminName" ng-model="currentAdmin.name"/>
				<button class="btn btn-primary" ng-click="saveAdminAccount()" ng-disabled="!currentAdmin.name" l="accounts.admin.save">Save</button>
			</div>
			<!-- List of assigned businesses. -->
			<div class="account-businesses-list" ng-show="currentAdmin.id">
	    		<h3 l="accounts.admin.businesses.list.title">Assigned businesses</h3>
	    		<ul class="nav nav-pills nav-stacked">
		       	 	<li ng-repeat="business in adminBusinesses">
			        	<a><i class="icon-move icon-black"></i> {{business.name}}</a>
			        </li>
    			</ul>
	    	</div>
		</div>
		<!-- Holds the list of businesses assigned to this company. For easy drag&drop assignement to selected admin account. -->
		<div class="common-wrapper span4" ng-show="currentAdmin.id">
			<h3 l="accounts.all.businesses.list.title">Available businesses</h3>
			<p l="accounts.all.businesses.list.description">Drag & Drop to the list of assigned businesses for which the user shall have access.</p>
			<ul class="nav nav-pills nav-stacked">
	       	 	<li ng-repeat="business in allBusinesses">
		        	<a><i class="icon-move icon-black"></i> {{business.name}}</a>
		        </li>
    		</ul>
		</div>
	</div>
	<!-- Tab for cockpit accounts. -->
	<div ng-show="tab == 'cockpit'">
		<div class="span2">
			<ul class="nav nav-pills nav-stacked">
				<li>
					<a ng-click="createCockpitAccount()"><i class="icon-plus icon-black"></i> <span l="accounts.cockpit.list.new">New user account...</span></a>
				</li>
		        <li ng-repeat="account in users | orderBy:['login'] " ng-class="{active: currentUser.id == account.id}">	        	
		        	<a ng-click="loadCockpitAccount(account)">{{account.login}}</a>
		        </li>
		    </ul>
		</div>
		<div class="common-wrapper span4" ng-show="currentUser">
			<div ng-show="currentUser.id">
				<h3>Edit User Account</h3>
				<form name="editUserForm" class="form-vertical" ng-submit="saveCockpitAccount()">
				<label for="userName" l="accounts.name">Name: </label>
				<input type="text" id="userName" ng-model="currentUser.name"/>
	        	<div class="control-group" ng-class="getFieldInputClass(editUserForm.login.$dirty, editUserForm.login.$invalid)">
		        	<label for="userLogin" class="control-label" l="registration.form.login">Login *:</label>
		        	<div class="controls">
						<input name="login" id="userLogin" type="text" ng-model="currentUser.login" required ng-pattern="/^[a-z0-9_\.-]{4,30}$/" placeholder="login name" >
						<div class="help-inline" ng-show="editUserForm.login.$dirty && editUserForm.login.$invalid">
			          		<span ng-show="editUserForm.login.$error.required" l="registration.form.login.error.required">Provide a username.</span>
			          		<span ng-show="editUserForm.login.$error.pattern" l="registration.form.login.error.pattern">4 - 30 characters. Only lower case, digits, "_" "-" "." are allowed.</span>
			        	</div>
					</div>
				</div>
				<div class="control-group" ng-class="getFieldInputClass(editUserForm.password.$dirty, editUserForm.password.$invalid)">
					<label for="password" class="control-label" l="registration.form.password">Password:</label>
					<div class="controls">
						<input name="password" type="password" ng-model="currentUser.password" ng-pattern="/^(?=[!-~]{6,}$)(?=.*([^A-Za-z0-9]|\d))(?=.*[a-zA-Z]).*$/" ng-change="matchPasswords(editUserForm)" placeholder="your password" l-attribute="placeholder" l="registration.form.password.placeholder">
						<div class="help-inline" ng-show="editUserForm.password.$dirty && editUserForm.password.$invalid">
			          		<span ng-show="editUserForm.password.$error.pattern" l="registration.form.password.error.pattern">Min. 6 characters. Must contain a letter and a number or one special character.</span>
			        	</div>
					</div>
				</div>
				<div class="control-group" ng-class="getFieldInputClass(editUserForm.passwordRepeat.$dirty, editUserForm.passwordRepeat.$invalid)">
					<label class="control-label" for="passwordRepeat" l="registration.form.passwordrepeat">Repeat password *:</label>
					<div class="controls">
						<input name='passwordRepeat' type='password' ng-model="passwordRepeat" ng-change="matchPasswords(editUserForm)" placeholder="repeat your password" l-attribute="placeholder" l="registration.form.passwordrepeat.placeholder">
						<div class="help-inline" ng-show="editUserForm.passwordRepeat.$invalid">
			          		<span ng-show="editUserForm.passwordRepeat.$error.match" l="registration.form.passwordrepeat.error.match">Passwords don't match.</span>
		        		</div>
					</div>
				</div>
				<button class="btn" l="common.close" ng-click="currentUser=null;">Cancel</button>
				<button type="submit" class="btn btn-primary" ng-disabled="editUserForm.$invalid" l="common.save">Save</button>
			</form>

			</div>
			<div ng-hide="currentUser.id">
				<h3>New User Account</h3>
				<form name="userForm" class="form-vertical" ng-submit="saveCockpitAccount()">
					<label for="newUserName" l="accounts.name">Name: </label>
					<input type="text" id="newUserName" ng-model="currentUser.name"/>
		        	<div class="control-group" ng-class="getFieldInputClass(userForm.login.$dirty, userForm.login.$invalid)">
			        	<label for="newUserLogin" class="control-label" l="registration.form.login">Login *:</label>
			        	<div class="controls">
							<input name="login" id="newUserLogin" type="text" ng-model="currentUser.login" required ng-pattern="/^[a-z0-9_\.-]{4,30}$/" placeholder="login name" >
							<div class="help-inline" ng-show="userForm.login.$dirty && userForm.login.$invalid">
				          		<span ng-show="userForm.login.$error.required" l="registration.form.login.error.required">Provide a username.</span>
				          		<span ng-show="userForm.login.$error.pattern" l="registration.form.login.error.pattern">4 - 30 characters. Only lower case, digits, "_" "-" "." are allowed.</span>
				        	</div>
						</div>
					</div>
					<div class="control-group" ng-class="getFieldInputClass(userForm.password.$dirty, userForm.password.$invalid)">
						<label for="newPassword" class="control-label" l="registration.form.password">Password *:</label>
						<div class="controls">
							<input id="newPassword" name="password" type="password" ng-model="currentUser.password" required ng-pattern="/^(?=[!-~]{6,}$)(?=.*([^A-Za-z0-9]|\d))(?=.*[a-zA-Z]).*$/" ng-change="matchPasswords(userForm)" placeholder="your password" l-attribute="placeholder" l="registration.form.password.placeholder">
							<div class="help-inline" ng-show="userForm.password.$dirty && userForm.password.$invalid">
				          		<span ng-show="userForm.password.$error.required" l="registration.form.password.error.required">Provide a password.</span>
				          		<span ng-show="userForm.password.$error.pattern" l="registration.form.password.error.pattern">Min. 6 characters. Must contain a letter and a number or one special character.</span>
				        	</div>
						</div>
					</div>
					<div class="control-group" ng-class="{error: userForm.passwordRepeat.$invalid, success: !userForm.passwordRepeat.$invalid && userForm.passwordRepeat.$dirty }">
						<label class="control-label" for="newPasswordRepeat" l="registration.form.passwordrepeat">Repeat password *:</label>
						<div class="controls">
							<input id="newPasswordRepeat" name='passwordRepeat' type='password' ng-model="passwordRepeat" ng-change="matchPasswords(userForm)" placeholder="repeat your password" l-attribute="placeholder" l="registration.form.passwordrepeat.placeholder">
							<div class="help-inline">
				          		<span ng-show="userForm.passwordRepeat.$error.match" l="registration.form.passwordrepeat.error.match">Passwords don't match.</span>
			        		</div>
						</div>
					</div>
					<button class="btn" l="common.close" ng-click="currentUser=null;">Cancel</button>
					<button type="submit" class="btn btn-primary" ng-disabled="userForm.$invalid" l="common.save">Save</button>
				</form>
			</div>
		</div>
	</div>
</div>
